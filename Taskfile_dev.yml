version: '3'

tasks:

  about:
    desc: Generate about.py
    cmds:
      - ./scripts/version.sh
    status:
      - test -s archivist/about.py

  audit:
    desc: Audit the code
    deps: [about]
    cmds:
      - pip-audit -r requirements.txt

  check:
    desc: Check the style, bug and quality of the code
    deps: [about]
    cmds:
      - python3 --version
      - pycodestyle --format=pylint setup.py archivist examples functests unittests
      - python3 -m pylint --rcfile=pylintrc setup.py archivist examples functests unittests
      - python3 -m pyright archivist

  clean:
    desc: Clean git repo
    cmds:
      - find -name '*,cover' -type f -delete
      - git clean -fdX

  deps:
    desc: Show dependency tree
    cmds:
      - /bin/bash -c "pipdeptree"

  docs:
    desc: Create sphinx documentation
    deps: [about]
    cmds:
      - /bin/bash -c "cd docs && make clean && make html"

  format:
    desc: Format code using black
    deps: [about]
    cmds:
      - black setup.py archivist examples functests unittests

  functests:
    desc: Run functests - requires an archivist instance and a authtoken
    deps: [about]
    cmds:
      - ./scripts/functests.sh
  
  type-check:
    desc: Runs the pyright type checker against the core archivst files 
    deps: [about]
    cmds:
      - pyright archivist

  notebooks:
    desc: Run jupyter notebooks
    deps: [about]
    cmds:
      - jupyter notebook --ip 0.0.0.0 --no-browser --notebook-dir=./notebooks/

  unittests:
    desc: Run unittests
    deps: [about]
    cmds:
      - ./scripts/unittests.sh
