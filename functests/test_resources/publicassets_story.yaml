---
steps:
  - step:
      action: ASSETS_CREATE_IF_NOT_EXISTS
      description: Create a public door in Paris at Jitsuin offices.
      asset_label: Jitsuin Paris Public Front Door
    selector:
      - attributes:
        - arc_display_name
        - arc_namespace
    behaviours:
      - RecordEvidence
      - Attachments
    attributes:
      arc_display_name: Jitsuin Paris Front Door
      arc_namespace: !ENV ${ARCHIVIST_NAMESPACE:namespace}
      arc_display_type: door
      arc_firmware_version: "1.0"
      arc_serial_number: das-j1-01
      arc_description: Electronic door entry system to Jitsuin France
      wavestone_asset_id: paris.france.jitsuin.das
    public: true
    location:
      selector:
        - display_name
        - attributes:
          - namespace
      display_name: Jitsuin Paris
      description: Sales and sales support for the French region
      latitude: 48.8339211
      longitude: 2.371345
      attributes:
        namespace: !ENV ${ARCHIVIST_NAMESPACE:namespace}
        address: 5 Parvis Alan Turing, 75013 Paris, France
        wavestone_ext: managed
    attachments:
      - filename: functests/test_resources/doors/assets/entry_terminal.jpg
        content_type: image/jpg
    confirm: true

  # opening a door requires 2 events to be created with the same
  # correlation value "be5c8061-236d-4400-a625-b74a34e5801b" and the
  # same principal declared..
  - step:
      action: EVENTS_CREATE
      description: Jitsuin Paris Public Front Door opened with card 2
      asset_label: Jitsuin Paris Public Front Door
      print_response: true
    operation: Record
    behaviour: RecordEvidence
    principal_declared:
      subject: courts.paris.wavestonedas
      email: courts.paris.wavestonedas@iot.wavestone.com
      display_name: Courts of Justice Paris Front Door machine credential
    event_attributes:
      arc_description: Door opened by authorized key card Access Card 2
      arc_display_type: Door Open
      arc_evidence: ARQC 0x12345678
      arc_correlation_value: be5c8061-236d-4400-a625-b74a34e5801b
      wavestone_card_name: Access Card 2
      wavestone_evt_type: door_open
    attachments:
      - filename: functests/test_resources/doors/events/door_open.png
        content_type: image/png
    confirm: true

  - step:
      action: PUBLICEVENTS_COUNT
      description: Count all events for Jitsuin Paris Public Front Door
      print_response: true
      asset_label: Jitsuin Paris Public Front Door

  - step:
      action: PUBLICEVENTS_LIST
      description: List all events for Jitsuin Paris Public Front Door
      print_response: true
      asset_label: Jitsuin Paris Public Front Door
